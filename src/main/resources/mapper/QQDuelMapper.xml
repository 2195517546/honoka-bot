<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.uiloalxise.honoka.mapper.QQDuelMapper">
    <insert id="addDuelPlayer">
        insert into duel_player (open_id, money, win, lost, user_name) values (#{openId},#{money},#{win},#{lost},#{userName});
    </insert>

    <!-- 交到审核中去防止出意外   -->
    <update id="updateDuelPlayer">
        UPDATE duel_player
        SET new_user_name = #{userName}
        WHERE open_id = #{openId};
    </update>

    <select id="selectDuelPlayerByOpenId" resultType="com.uiloalxise.pojo.entity.DuelPlayer">
        select * from duel_player where open_id = #{openId};
    </select>
    <select id="rankDuelPlayerByKD" resultType="com.uiloalxise.pojo.entity.DuelPlayer">
        SELECT *,
               CASE
                   WHEN lost = 0 THEN NULL
                   ELSE (win / lost)
                   END AS win_loss_ratio
        FROM duel_player
        WHERE lost > 0
        ORDER BY win_loss_ratio DESC
        LIMIT 10;
    </select>
</mapper>